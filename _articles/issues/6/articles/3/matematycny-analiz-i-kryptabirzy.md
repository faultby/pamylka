---
layout: article
title: "Матэматычны аналiз i крыптабiржы"
author: "Алесь Радына"
category_en: "Mathematics"
category_be: "Матэматыка"
cover: "issues/6/articles/3/images/cover.png"
issue: 6
slug: matematycny-analiz-i-kryptabirzy
---

# МАТЭМАТЫЧНЫ АНАЛIЗ I КРЫПТАБIРЖЫ

Алесь Радына

{:.intro-paragraph}
Даволi нечакана было даведацца, што звычайны матэматычны аналiз – вылiчэнне вытворных ад функцыяў, зададзеных яўна; вылiчэнне вытворных ад функцыяў, зададзеных параметрычна; вылiчэнне вытворных ад функцыяў, зададзеных няяўна; вылiчэнне лiмiтаў; правiла Ль’Апiталя *(l’Hôpital)*; шэрагi; наблiжэннi; iнтэгралы; iнтэгральныя пераўтварэннi; лiмiтавыя пераходы i ўся iншая тэхнiка матэматычнага аналiзу, добра вядомая кожнаму студэнту мехмату, – прыдасца ў такой вельмі камп’ютарнай i так бы мовiць выключна дыскрэтнай, цi канечнай галiне як крыптабiржы. Аднак гэта так! Магчыма, заходні студэнт, знаёмы з эканамiчнымi тэорыямi, фiнансаваю матэматыкай i падобнымi дысцыплiнамi, не здзiвіцца, што вытворная мае не толькi геаметрычны i механiчны (фiзічны) сэнс, з якiм знаёмяць кожнага школьнiка, але яшчэ i эканамiчны ды нават фiнансавы!

![вокладка артыкулу "МАТЭМАТЫЧНЫ АНАЛIЗ I КРЫПТАБIРЖЫ"]({{ site.baseurl }}/issues/6/articles/3/images/cover.png){:.article-image}

{:.figure-info}
Ідэя і аўтарства фатаграфіі: [Косця Helaku](https://www.instagram.com/knst-h-bnw/)

Гэты артыкул – спроба прыцягнуць увагу чытача да вышэйшае матэматыкi і ўласна матэматычнага аналiзу як iнструменту даследавання працэсаў, што адбываюцца ў пулах крыптабiржаў. Адразу скажу, што гаворка пойдзе пра так званыя дэцэнтралiзаваныя крыптабiржы, якiя дзеюць паводле пэўных запраграмаваных правiлаў аўтаматычна, без удзелу нейкага аднаго кiраўнічага органу, то бок *дэцэнтралiзавана*.

### ДЭЦЭНТРАЛIЗАВАНАЯ БIРЖА (*DEX*) СУПРАЦЬ ЦЭНТРАЛIЗАВАНАЙ (*CEX*)

Дэцэнтралiзаваныя крыптабiржы, альбо *DEX* – адмысловы набор алгарытмаў i пратаколаў для вызначэння колькасцi рэсурсаў у пуле ды кошту абмену аднаго рэсурсу на другi. Як правiла, у пуле – дзве валюты (альбо два рэсурсы), колькасць якіх апiсваецца нейкiм законам, што называецца **iнварыянтам**. Адразу варта зазначыць, што *DEX* зарганiзаваны iнакш, чымся цэнтралiзаваныя крыптабiржы, цi **CEX**, i гэта накладае адбiтак на пратаколы гандлю ды iншую працу бiржы. Класiчная *CEX*-бiржа складаецца з пакупнiкоў i прадаўцоў. Пакупнiкi выстаўляюць заяўкi ў ордэрбук (*order book*), а прадаўцы падаюць заяўкi i ўяўляюць сабою так бы мовiць контрагентаў пакупнiкоў. Калi кошт пакупкi ад нейкiх пакупнiкоў супадае з коштам продажу, выстаўленым прадаўцамi, то адбываецца ўгода i абмен рэсурсамi памiж прадаўцамi ды пакупнiкамi. Не заўсёды пакупнiкi выкупляюць увесь рэсурс прадаўцоў, i, наадварот, можа быць так, што пакупнiкі яшчэ ёсць, а прадаўцы за такi кошт ужо закончылiся, тады ўзнiкае паўза. За стары кошт рэсурсу не купiць (не прадаць), а новыя кошты могуць быць нявыгадныя. Як кажуць, рынак робіцца <u>неліквідны</u>.

### ДАСТАЎЦЫ ЛIКВIДНАСЦI ЯК ЯШЧЭ АДЗIН ПЛЮС ДЭЦЭНТРАЛIЗАВАНАЕ БIРЖЫ

На *DEX* таксама ёсць прадаўцы i пакупнiкi, іх называюць класiчна – трэйдарамi, але ёсць яшчэ i дастаўцы лiквiднасцi – асобы, якiя залiваюць на бiржу <u>абодва</u> рэсурсы. Бiржа *DEX* выплочвае ўзнагароду такiм асобам, бо яны забяспечваюць якраз лiквiднасць рынку, i абмен на бiржы iдзе без затрыманняў, бо не трэба шукаць для трэйдара контрагента: рэсурсы на бiржы заўсёды ёсць. Але ў працэсе ўгодаў колькасць рэсурсаў у пуле бiржы змяняецца: аднаго рэсурсу робіцца больш, а другога менш, i ад гэтага кошт на другi рэсурс расце, курс змяняецца ў працэсе ўгоды. Гэтая з’ява называецца **слiпіджам** (ад анг. *slippage* – праслiзгванне, прабуксоўванне). Трохi далей я напiшу, што гэта азначае матэматычна. Гэтая з’ява непрыемная для трэйдараў i можа адштурхнуць iх ад карыстання бiржаю. Таму пажадана, каб слiпідж быў мiнiмальны – цана рэсурсу змянялася нязначна. Але слiпідж мае i станоўчы бок. Дапусцiм, абодвух рэсурсаў на бiржы шмат, тады знiкненне частачкi аднаго рэсурсу i дадаванне лыжачкi другога нiчым не пагражае. Робіцца непрыемна (для бiржы), калi аднаго рэсурсу мала, а другога шмат. Гэта пагражае тым, што першы рэсурс можа ўвогуле знiкнуць (у выпадку занiжанай на яго цаны), нейкi зласлiвец можа выпампаваць увесь рэсурс i запампаваць адпаведна ў пул другi, танны рэсурс. Тады бiржа збанкрутуе. А каб гэтага не было, пры змяншэннi нейкага рэсурсу да крытычнай адзнакi цана на яго павiнна вырасцi так, каб смактуну было нявыгадна далей купляць гэты рэсурс, каб высмактаць яго да дна.

### АСНОЎНЫЯ ПАНЯТКI. ФУНКЦЫЯ ЗАХАВАННЯ

На восi x будзем адкладваць колькасць базавага рэсурсу, а на восi y – колькасць квотнага рэсурсу (*quote resource*). Яго яшчэ называюць рызыкоўным (*risk resource*). Няхай першапачаткова ў пуле бiржы – *X* базавага рэсурсу, Y квотнага рэсурсу. У сiстэме каардынатаў xOy маем пункт (*X; Y*). Усё, што адбываецца, будзем разглядаць з боку бiржы. Дапусцiм, людзi купляюць базавы рэсурс *X*, i яго ў пуле менее: адпаведна квотнага рэсурсу робіцца болей i што курс базавага рэсурсу ўзрасце, працэс яго скупляння запаволiцца, калi не спынiцца ўвогуле, працэс пойдзе ў адваротным кiрунку. Аднак лiквiднасць (здабытак *X · Y*) мае застацца такая сама. Гэты закон захавання лiквiднасцi i называецца функцыяй захавання. У гэтым простым выпадку ён будзе мець выгляд:

$$
x \cdot y = X \cdot Y \tag{1}
$$

Каб было прасцей, пачатковую лiквiднасць пазначаюць лiтараю L, i L = X·Y. Тады роўнасць (1) перапiшацца:

$$
x \cdot y = L \tag{2}
$$

Як вiдаць, функцыя захавання тут будзе звычайная гiпербала, што паказвае працэс змянення рэсурсаў. Гэтая гiпербала адпавядае пратаколу крыптавалютнае бiржы, што завецца Uniswap V2. Функцыя (2) лёгка выражаецца яўна

$$
y = \frac{L}{x} \tag{3}
$$

i можна ад яе палiчыць вытворную:

$$
y' = - \frac{L}{x^2} \tag{4}
$$

Змяненне рэсурсу Y на крывой (3) будзем пазначаць Δy. Яго паменела, але затое рэсурсу X прырасло на Δx. Гэтак, на бiржы абменены рэсурс −Δy на рэсурс Δx. Ясна, што курс, паводле якога адбыўся абмен, будзе

$$
r = - \frac{\Delta y}{\Delta x}
$$

Знак мiнус стаiць, бо курс r мусiць быць дадатны, а Δy адмоўнае з прычыны змяншэння рэсурсу. Цяпер, калi гаворка пра мiкраўгоды, а гэта магчыма, бо крыптавалюты могуць драбнiцца на дастаткова малыя часткi, то ў роўнасцi (5) можна перайсцi да лiмiту, калi Δx → 0. У гэтым выпадку iмгненны курс аднаго рэсурсу адносна другога будзе раўняцца мiнус вытворнай!

$$
r = - y'_{x} \tag{5}
$$

Iснуюць розныя функцыi захавання. Вышэй мы разгледзелi самую простую, але, як было згадана ў раздзеле вышэй, важна сачыць за слiпіджам – змяненнем цаны падчас угоды. Матэматычна слiпідж азначае рэзкае змяненне вытворнай (6). Можна зрабiць такую крывую захавання, што яе вытворная будзе канстантаю – цана не змяняецца ўвогуле. Такая функцыя ўсiм вядомая: гэта лiнейная функцыя, гл. Мал. 1, дзе чырвонаю лiнiяй адзначана простая x + y = 1, вытворная ад якой – заўсёды канстанта 1, значыць, не змяняецца. Вiдаць, што графiк спецыяльна падабранай функцыi захавання *Stable Swap* вельмi блiзка праходзiць ад чырвонай простай амаль на ўсiм дыяпазоне. Гэта дазваляе казаць, што яе вытворная амаль не змяняецца (другая вытворная блiзкая да нуля!) i таму цана амаль не змяняецца амаль на ўсiм дыяпазоне, слiпідж невялiкi. Аднак калi рэсурсу Y робіцца мала, кошт на яго рэзка вырастае i пагрозы яго вычарпання цi банкруцтва бiржы ўжо няма. Як бачым, тут рэй вядуць першыя i другiя вытворныя: першая вытворная звязаная з цаной цi курсам аднаго рэсурсу адносна другога, а другая вытворная звязаная са слiпіджам. Цiкава, што функцыя захавання для Stable Swap задаецца выключна няяўным раўнаннем

$$
4A(x+y) + G - 4AG - \frac{G_3}{xy} = 0 \tag{6}
$$

![Мал. 1. Stable Swap]({{ site.baseurl }}/issues/6/articles/3/images/fig-1.png){:.article-image}

{:.figure-title}
Мал. 1. Stable Swap – сiняя крывая, зацiснутая памiж лiнейнаю функцыяй i гiпербалаю

Параметры A i G вызначаюць форму крывой: калi A = 0, крывая супадае з зялёнаю лiнiяй (гiпербалаю 4xy = G2), а калi A iмкнецца да бясконцасцi, то Stable Swap iмкнецца да чырвонае лiнii (простай x + y = G).

Ну i, калi трэба палiчыць вытворную, то давядзецца яе лiчыць як вытворную няяўнае функцыi. I зноў матаналіз!

а шчасце, мы тут маем не адну крывую, што апiсвае пратакол узаемадзеяння памiж дзвюма валютамi. У артыкуле [2] пры-ведзеная цэлая таблiца з пяцi крывых, што апiсваюць розныя пратаколы аўтаматычнага гандлю на дэцэнтралiзаваных бiржах: *Uniswap V2*, *Uniswap V3* [3], *Balancer* [4], *Curve* [5], *Dodo* [6]. Гэта, натуральна, не поўны пералiк iсных пратаколаў. Кожны з iх усё больш адаптуецца да клiентаў i сiтуацыi на рынку. Цяпер распрацоўваецца *Hypersea* [1], дзе ёсць частка i маёй працы.

### НЕКАТОРЫЯ ПРАБЛЕМЫ ЗВЯЗАНЫЯ З КРЫВОЮ ЗАХАВАННЯ. ЗАДАЧА АДШУКАЦЬ РАЎНАВАЖНЫ ПУНКТ І ЗАХАВАННЕ АРБІТРАЖНАГА МОМАНТУ

Часцей выбiраюцца больш простыя крывыя, якія адпавядаюць аналагiчным сiтуацыям, што раней мадэлявалi эканамiсты ў сваiх даследаваннях. Гэтак, мы i тут сустракаем мадэль Коба – Даґласа (*Cobb–Douglas*), або мадэль Леонцьева, або крывую сталай эластычнасцi функцыi падстаноўкi (*Constant Elasticity of Substitution function*). Аднак усе гэтыя крывыя апiсваюць траекторыю змянення стану пулу бiржы падчас гандлю. Гэта iдэальная крывая, што малюецца толькi ў нас у галаве, бо гэтак нам зручней думаць. У рэчаiснасцi кожны стан нашага пулу трэба аблiчваць з дапамогаю праграмаў i нейкiх алгарытмаў, не заўсёды можна палiчыць усе станы дакладна. Часта даводзіцца выкарыстоўваць наблiжаныя мета ды, напрыклад, метад Ньютана, а тут iснуе праблема збежнасцi i колькасцi iтэрацыяў, бо праграмаванне ў блокчэйне таксама патрабуе грошай: кожная аперацыя мае сваю цану. Можна прыдумаць шыкоўную простую крывую, ад якой зручна браць вытворныя, якая добра кладзецца нам у мозг, але ў праграме яна будзе вельмi дарагая пры аблiку i нявыгаднаю для карыстання ў смарткантрактах, то бок праграмах, дзе апiсваецца пратакол абмену.

Усе гэтыя пратаколы i крывыя, што iх апiсваюць, узнiклi не проста так, а з патрэбаў рынку. Напрыклад, у пратаколе *Uniswap V2* трэба было дастаўцам лiквiднасцi, калi яны хацелi папоўнiць пул валютамi (пара валютаў завецца лiквiднасцю), укладаць iх у пул прапарцыйна той колькасцi валютаў, што ляжыць у пуле. Напрыклад, калi ў пуле 80 % *USDT* i 20 % Bitcoins, то правайдар лiквiднасцi меў пакласцi ў пул 4 USDT i 1 *Bitcoin* або 8 *USDT* i 2 *Bitcoins* ды г. д. Гэта вельмi нязручна, бо прапорцыя манетаў у пуле можна змянiцца ў любы момант у вынiку абмену адной манеты на другую (трэйдарская ўгода). Тут узнiкае праблема балансу памiж пулам i стаўкаю дастаўцы лiквiднасцi, што развязваецца з дапамогаю звычайнае прапорцыi. Праблема зводзiцца да выпадку, калi дастаўца лiквiднасцi прыходзiць толькi з адным рэсурсам на руках, а другi здабывае на гэтай жа бiржы ў вынiку абмену без камiсii. Каб не тлумiць галавы чытача формуламi, скажу, што гэтую праблему развяжа нават школьнiк, але ўжо ў выпадку, калi бiржа бярэ за абмен камiсiю, заданне рэзка пагаршаецца i пераходзiць у стан развязальных метадамi наблiжэння: напрыклад, шэрагамi Тэйлара (*Taylor*). I тут трэба глядзець, цi мэтазгодна яе ўвогуле развязваць, бо колькасць iтэрацыяў можа быць вельмi дарагая, што выдаткi на выкананне смарткантракту будуць большыя за камiсiю. Я хачу сказаць, што шмат залежыць ад таго, якiм метадам развязваецца праблема. Тут без матэматычнага аналiзу i тэорыi наблiжэнняў не абысцiся.

Далей цiкавы выпадак, калi рэальны кошт нашага базавага рэсурсу r адрознiваецца ад кошту, палiчанага з дапамогаю вытворнай паводле формулы (6). Тут трэба правесцi такую крывую захавання, каб яна прайшла праз iсны стан пулу бiржы (пункт (*X; Y*) i праз пункт, дзе −
*y′ (X<sub>e</sub>; Y<sub>e</sub>) = r*), пры гэтым каб захоўваўся арбiтражны момант – частка квотнага рэсурсу альбо частка базавага рэсурсу, што аддаецца арбiтражору (цi папросту спекулянту-трэйдару), якi ў пагонi за гэтаю часткаю рэсурсу пачне гандляваць i зменiць цану ў слушным кiрунку, г. зн. перамесцiць стан пулу з пункту (*X; Y*) у пункт (*X<sub>e</sub>; Y<sub>e</sub>*).

Убачыць развязанне гэтага задання ў дзеяннi можна на сайце Hypersea (https://research.hypersea.com/chart), а падрабязнае апiсанне i развязанне задання – у артыкуле [1]. У гэтай нататцы я толькi паказаў частку таго, як натуральным чынам у дэцэнтралiзаваным iнтэрнэце, а менавiта ў дэцэнтралiзаваных крыптабiржах, узнiкае панятак крывой, няяўна зададзенай крывой, вытворнай i якiя заданні з iмi звязаныя. Але ў згаданым артыкуле прыводзiцца нашмат больш выпадкаў выкарыстання вытворных ад крывых захавання. *DEX* – прыклад дэцэнтралiзаванага iнтэрнэту *web3*, за якiм будучыня.

На гэтым прынцыпе можна ствараць i ствараюцца не толькi бiржы, але i дэцэнтралiзаваныя арганiзацыi (DAO), фiрмы, сiстэмы
падлiку галасоў на выбарах (Аўстралiя, Эстонiя, Швейцарыя), а ў будучынi, можа, убачым цалкам дэцэнтралiзаваную дзяржаву.

![Мал. 2.]({{ site.baseurl }}/issues/6/articles/3/images/fig-2.png){:.article-image}

{:.figure-title}
Мал. 2. Квотны i базавы арбiтражныя моманты пазначаныя чырвонымi стрэлкамi

![Іл. 3.]({{ site.baseurl }}/issues/6/articles/3/images/fig-3.png){:.article-image}

{:.figure-info}
Ідэя і аўтарства фатаграфіі: [Косця Helaku](https://www.instagram.com/knst-h-bnw/)

![Іл. 4.]({{ site.baseurl }}/issues/6/articles/3/images/fig-4.png){:.article-image}

{:.figure-info}
Ідэя і аўтарства фатаграфіі: [Косця Helaku](https://www.instagram.com/knst-h-bnw/)

{:.references}
### КРЫНІЦЫ:

{:.references}
1. Ressin, A. Radyna, A. Bokhenek, A. : Hypersea Whitepaper (v.1.0 Preview), [https://hypersea.com/Hypersea-Whitepaper-1.0-Preview.pdf](https://hypersea.com/Hypersea-Whitepaper-1.0-Preview.pdf)
2. Xu, Jiahua and Paruch, Krzysztof and Cousaert, Simon and Feng, Yebo: SoK: Decentralized Exchanges (*DEX*) with Automated Market Maker (AMM) Protocols, 2021, [https://arxiv.org/abs/2103.12732](https://arxiv.org/abs/2103.12732)
3. Adams, H.: Uniswap v3 core, 2021, [https://uniswap.org/whitepaper-v3.pdf](https://uniswap.org/whitepaper-v3.pdf)
4. Martinelli, F. Mushegian, N. : A non-custodial portfolio manager, liquidity provider, and price sensor, 2019, [https://balancer.fi/whitepaper.pdf](https://balancer.fi/whitepaper.pdf)
5. Egorov, M.: Automatic market-making with dynamic peg, 2021, https://classic.curve.fi/files/crypto-pools-paper.pdf
6. Dodo exchange: What is Dodo, [https://docs.dodoex.io/en/home/what-is-dodo](https://docs.dodoex.io/en/home/what-is-dodo)




